@model IEnumerable<GoodLuck.Models.Anniversary>

@{
    var now = DateTime.Today;
    var firstOfMonth = new DateTime(now.Year, now.Month, 1);
    var daysInMonth = DateTime.DaysInMonth(now.Year, now.Month);
    var startOffset = (int)firstOfMonth.DayOfWeek;
    var eventsByDay = Model
        .GroupBy(a => a.Date.Date)
        .ToDictionary(g => g.Key, g => g.ToList());
}

<div class="calendar-book">
    <h2 class="text-center">@now.ToString("MMMM yyyy")</h2>
    <div class="calendar">
        <div class="day-header">CN</div>
        <div class="day-header">T2</div>
        <div class="day-header">T3</div>
        <div class="day-header">T4</div>
        <div class="day-header">T5</div>
        <div class="day-header">T6</div>
        <div class="day-header">T7</div>

@for (int i = 0; i < startOffset + daysInMonth; i++)
{
    if (i < startOffset)
    {
        <div class="day other-month"></div>
    }
    else
    {
        var day = i - startOffset + 1;
        var date = firstOfMonth.AddDays(day - 1);
        var hasEvent = eventsByDay.ContainsKey(date);
        var cssClass = hasEvent ? "day event" : "day";
        <div class="@cssClass">
            <div class="date-num">@day</div>
            @if (hasEvent)
            {
                foreach (var ev in eventsByDay[date])
                {
                    <div class="event-title">@ev.Title</div>
                }
            }
        </div>
    }
}
    </div>
</div>
